<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vehículos terminados - TallerX</title>
<link rel="stylesheet" href="../Css/login.css">
</head>
<body>
  <video class="bg-video" autoplay muted loop playsinline>
    <source src="../images/fondo%20proyecto.mp4" type="video/mp4">
  </video>
  <header class="topbar"><div class="brand"><img src="../images/logo.webp" class="logo"><span class="brand-name">TallerX</span></div>
    <div class="center-link"><a class="home-link" href="mecanico_dashboard.html">Inicio</a></div>
    <div>
      <span id="sessionBadge" class="session-badge" style="display:none"></span>
    </div>
    <div class="user-area hamburger-menu"><a href="#" class="user-btn" id="userBtn">☰</a>
      <div class="menu" id="userMenu"><a href="mecanico_dashboard.html">Inicio</a><a href="../index.html">Cerrar sesión</a></div>
    </div>
  </header>
  <main>
    <section class="section" style="padding-top:40px">
      <h2>Vehículos terminados</h2>
      <div id="list" class="cards"></div>
    </section>
  </main>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const key = 'finished_vehicles';
  const deliveredKey = 'delivered_vehicles';
  const list = document.getElementById('list');
  const items = JSON.parse(localStorage.getItem(key) || '[]');
  if(items.length===0) list.innerHTML='<p>No hay vehículos terminados.</p>';
  items.forEach((v,idx)=>{
    const card = document.createElement('div'); card.className='card login-card';
    card.innerHTML = `<img src="${v.photo||'../images/mantenimiento.jpg'}" style="width:100%;height:120px;object-fit:cover;border-radius:8px"><h3>${v.title||'Sin placa'}</h3><p>${v.problems||''}</p><button data-idx="${idx}" class="btn deliver">Entregar vehículo</button>`;
    list.appendChild(card);
  });
  list.addEventListener('click',(e)=>{
    if(e.target.classList.contains('deliver')){
      const idx = Number(e.target.dataset.idx);
      const v = items[idx];
      const details = prompt('Detalle del trabajo para el cliente:','Reparación y mantenimiento realizado');
      if(details!==null){
        // move to delivered with details
        const delivered = JSON.parse(localStorage.getItem(deliveredKey)||'[]');
        v.details = details;
        delivered.push(v);
        localStorage.setItem(deliveredKey, JSON.stringify(delivered));
        // remove from finished
        items.splice(idx,1);
        localStorage.setItem(key, JSON.stringify(items));
        // send via whatsapp (example number)
        const phone = '3158178155';
        const text = encodeURIComponent(`Su vehículo ${v.title||''} ha sido entregado. Detalles: ${details}`);
        window.open(`https://wa.me/${phone}?text=${text}`,'_blank');
        location.reload();
      }
    }
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const userBtn = document.getElementById('userBtn');
  const userMenu = document.getElementById('userMenu');
  if(userBtn) userBtn.addEventListener('click', (e)=>{ e.preventDefault(); userMenu.classList.toggle('show'); });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const badge = document.getElementById('sessionBadge');
  const logout = document.getElementById('logout');
  const user = JSON.parse(localStorage.getItem('user') || 'null');
  if(badge){ if(user){ badge.textContent = user.name || 'Usuario'; badge.style.display='inline-block'; } else { badge.style.display='none'; } }
  if(logout) logout.addEventListener('click', ()=>{ localStorage.removeItem('demoRole'); localStorage.removeItem('user'); });
});
</script>
</body>
</html>