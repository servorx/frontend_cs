<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vehículos entregados - TallerX</title>
<link rel="stylesheet" href="../Css/login.css">
<style>
body,html{height:100%;margin:0;font-family:Segoe UI, Roboto, Arial, sans-serif}
.bg-video{position:fixed;inset:0;width:100%;height:100%;z-index:-1;object-fit:cover}
.topbar{position:fixed;left:0;right:0;top:0;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg, rgba(0,0,0,0.35), transparent);backdrop-filter:blur(4px);z-index:1000}
main{padding-top:90px;box-sizing:border-box;padding-bottom:40px}

/* === Tarjetas === */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:20px;
  align-items:start;
  justify-content:center;
  padding:20px;
  box-sizing:border-box;
}
.card{
  background:#f3f3f3;
  color:#111;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,0.25);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  transition:transform .18s;
  height:420px;
}
.card:hover{transform:translateY(-6px)}
.card .imgwrap{height:150px;overflow:hidden;background:#ddd}
.card .imgwrap img{width:100%;height:100%;object-fit:cover;display:block}
.card .body{padding:12px;display:flex;flex-direction:column;flex:1}
.card h3{margin:0 0 8px 0;font-size:18px}
.card .desc{flex:1;overflow:auto;color:#111;line-height:1.35;margin-bottom:8px;max-height:100px}
.card .meta{color:#666;font-size:14px;margin-bottom:8px;display:flex;justify-content:space-between}
.card .actions{padding:0 12px 12px;text-align:center}
.signature{width:100%;height:120px;object-fit:contain;background:#fff;border:1px solid #ccc;border-radius:6px;margin-top:8px}

/* Botón limpiar historial */
.clear-btn{
  display:inline-block;
  background:#d32f2f;
  color:#fff;
  font-weight:bold;
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  margin:20px auto 0;
}
.clear-btn:hover{background:#b71c1c}
</style>
</head>
<body>
  <video class="bg-video" autoplay muted loop playsinline>
    <source src="../images/fondo%20proyecto.mp4" type="video/mp4">
  </video>

  <header class="topbar">
    <div class="brand"><img src="../images/logo.webp" class="logo" style="height:44px"><span class="brand-name">TallerX</span></div>
    <div class="center-link"><a class="home-link" href="mecanico_dashboard.html">Inicio</a></div>
    <div><span id="sessionBadge" class="session-badge" style="display:none"></span></div>
    <div class="user-area hamburger-menu"><a href="#" class="user-btn" id="userBtn">☰</a>
      <div class="menu" id="userMenu"><a href="mecanico_dashboard.html">Inicio</a><a href="../index.html">Cerrar sesión</a></div>
    </div>
  </header>

  <main>
    <section class="section">
      <h2 style="color:#0a84ff;margin-left:20px;">Vehículos entregados</h2>
      <div id="list" class="cards"></div>
      <div style="text-align:center;">
        <button id="clearHistory" class="clear-btn">➖ Borrar historial</button>
      </div>
    </section>
  </main>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const key = 'delivered_vehicles';
  const list = document.getElementById('list');
  const clearBtn = document.getElementById('clearHistory');

  let items = [];
  try{ items = JSON.parse(localStorage.getItem(key) || '[]'); }catch(e){ items = []; }

  if(items.length===0){
    list.innerHTML='<p style="margin:18px;color:#fff">No hay vehículos entregados.</p>';
  } else {
    items.forEach((v)=>{
      const card = document.createElement('article');
      card.className='card';

      const imgWrap = document.createElement('div');
      imgWrap.className='imgwrap';
      const img=document.createElement('img');
      img.src=v.photo||'../images/mantenimiento.jpg';
      img.alt='Foto vehículo';
      imgWrap.appendChild(img);

      const body=document.createElement('div');
      body.className='body';
      const title=document.createElement('h3');
      title.textContent=v.title||v.placa||'Sin placa';

      // descripción guardada por el mecánico
      const desc=document.createElement('div');
      desc.className='desc';
      desc.textContent=v.newDescription||v.workDetails||v.details||v.descripcion||v.problem||v.problems||'Sin descripción';

      // propietario y teléfono
      const meta=document.createElement('div');
      meta.className='meta';
      const ownerName=v.owner||v.propietario||v.nombrePropietario||v.propietarioNombre||v.nombre||'---';
      const phoneNum=v.phone||v.telefono||'---';
      const owner=document.createElement('div');
      owner.textContent=`Propietario: ${ownerName}`;
      const phone=document.createElement('div');
      phone.textContent=`Tel: ${phoneNum}`;
      meta.appendChild(owner);
      meta.appendChild(phone);

      // firma
      const sign=document.createElement('img');
      if(v.signature){
        sign.src=v.signature;
        sign.alt='Firma del cliente';
        sign.className='signature';
      }

      body.appendChild(title);
      body.appendChild(desc);
      body.appendChild(meta);
      if(v.signature) body.appendChild(sign);

      card.appendChild(imgWrap);
      card.appendChild(body);
      list.appendChild(card);
    });
  }

  // limpiar historial
  clearBtn.addEventListener('click', ()=>{
    if(confirm('¿Deseas borrar todo el historial de vehículos entregados?')){
      localStorage.removeItem(key);
      location.reload();
    }
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const userBtn=document.getElementById('userBtn');
  const userMenu=document.getElementById('userMenu');
  if(userBtn) userBtn.addEventListener('click',(e)=>{e.preventDefault();userMenu.classList.toggle('show');});
});
</script>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const badge=document.getElementById('sessionBadge');
  const logout=document.getElementById('logout');
  const user=JSON.parse(localStorage.getItem('user')||'null');
  if(badge){ if(user){ badge.textContent=user.name||'Usuario'; badge.style.display='inline-block'; } else { badge.style.display='none'; } }
  if(logout) logout.addEventListener('click',()=>{ localStorage.removeItem('demoRole'); localStorage.removeItem('user'); });
});
</script>

</body>
</html>
