<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vehículos pendientes - TallerX</title>
<link rel="stylesheet" href="../Css/login.css">
</head>
<body>
  <video class="bg-video" autoplay muted loop playsinline>
    <source src="../images/fondo%20proyecto.mp4" type="video/mp4">
  </video>
  <header class="topbar"><div class="brand"><img src="../images/logo.webp" class="logo"><span class="brand-name">TallerX</span></div>
    <div class="center-link"><a class="home-link" href="mecanico_dashboard.html">Inicio</a></div>
    <div>
      <span id="sessionBadge" class="session-badge" style="display:none"></span>
    </div>
    <div class="user-area hamburger-menu"><a href="#" class="user-btn" id="userBtn">☰</a>
      <div class="menu" id="userMenu"><a href="mecanico_dashboard.html">Inicio</a><a href="../index.html">Cerrar sesión</a></div>
    </div>
  </header>
  <main>
    <section class="section" style="padding-top:40px">
      <h2>Vehículos pendientes</h2>
      <div id="list" class="cards"></div>
    </section>
  </main>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const key = 'pending_vehicles';
  const finishedKey = 'finished_vehicles';
  const list = document.getElementById('list');
  const items = JSON.parse(localStorage.getItem(key) || '[]');
  if(items.length===0) list.innerHTML='<p>No hay vehículos pendientes.</p>';
  items.forEach((v,idx)=>{
    const card = document.createElement('div'); card.className='card login-card';
    card.innerHTML = `<img src="${v.photo || '../images/mantenimiento.jpg'}" style="width:100%;height:120px;object-fit:cover;border-radius:8px"><h3>${v.title || 'Sin placa'}</h3><p>${v.problems||''}</p><label><input type="checkbox" data-idx="${idx}"> Terminado</label>`;
    list.appendChild(card);
  });
  list.addEventListener('change', (e)=>{
    if(e.target.type==='checkbox'){
      const idx = Number(e.target.dataset.idx);
      const item = items[idx];
      // move to finished
      const finished = JSON.parse(localStorage.getItem(finishedKey)||'[]');
      finished.push(item);
      localStorage.setItem(finishedKey, JSON.stringify(finished));
      // remove from pending
      items.splice(idx,1);
      localStorage.setItem(key, JSON.stringify(items));
      // refresh
      location.reload();
    }
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const badge = document.getElementById('sessionBadge');
  const logout = document.getElementById('logout');
  const user = JSON.parse(localStorage.getItem('user') || 'null');
  // Only show a badge when a user object exists; avoid showing raw role strings like 'mecanico' in the topbar.
  if(badge){ if(user){ badge.textContent = user.name || 'Usuario'; badge.style.display='inline-block'; } else { badge.style.display='none'; } }
  if(logout) logout.addEventListener('click', ()=>{ localStorage.removeItem('demoRole'); localStorage.removeItem('user'); });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const userBtn = document.getElementById('userBtn');
  const userMenu = document.getElementById('userMenu');
  if(userBtn) userBtn.addEventListener('click', (e)=>{ e.preventDefault(); userMenu.classList.toggle('show'); });
});
</script>
</body>
</html>