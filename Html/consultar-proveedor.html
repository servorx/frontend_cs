<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Consultar proveedor - TallerX</title>
<link rel="stylesheet" href="../Css/login.css">
</head>
<body>
  <video class="bg-video" autoplay muted loop playsinline>
    <source src="../images/fondo%20proyecto.mp4" type="video/mp4">
  </video>
  <header class="topbar"><div class="brand"><img src="../images/logo.webp" class="logo"><span class="brand-name">TallerX</span></div>
    <div class="center-link"><a class="home-link" href="mecanico_dashboard.html">Inicio</a></div>
    <div>
      <span id="sessionBadge" class="session-badge" style="display:none"></span>
    </div>
    <div class="user-area hamburger-menu"><a href="#" class="user-btn" id="userBtn">☰</a>
      <div class="menu" id="userMenu"><a href="mecanico_dashboard.html">Inicio</a><a href="../index.html">Cerrar sesión</a></div>
    </div>
  </header>
  <main>
    <section class="section" style="padding-top:40px;max-width:920px;margin:0 auto;">
      <h2>Solicitar repuestos</h2>
  <form id="reqForm" class="login-card" style="padding:14px;max-width:720px;margin:0 auto;">
        <div id="items"></div>
        <button type="button" id="addItem" class="btn">➕ Añadir repuesto</button>
        <div style="height:12px"></div>
        <button type="submit" class="btn">Solicitar repuestos</button>
      </form>
    </section>
  </main>
<script>
function createItem(i){
  return `
  <div class="input-group item" data-i="${i}">
    <label>Adjuntar foto</label><input type="file" class="item-photo">
    <label>Nombre</label><input class="item-name" type="text">
    <label>Descripción</label><input class="item-desc" type="text">
    <label>Cantidad requerida</label><input class="item-qty" type="number" min="1" value="1">
  </div>`
}

document.addEventListener('DOMContentLoaded', ()=>{
  const itemsWrap = document.getElementById('items');
  const add = document.getElementById('addItem');
  let idx = 0;
  function addOne(){ itemsWrap.insertAdjacentHTML('beforeend', createItem(idx)); idx++; }
  addOne();
  add.addEventListener('click', addOne);
  document.getElementById('reqForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    // gather items
    const nodes = Array.from(document.querySelectorAll('.item'));
    const payload = [];
    for(const n of nodes){
      const photo = n.querySelector('.item-photo').files[0];
      const name = n.querySelector('.item-name').value.trim();
      const desc = n.querySelector('.item-desc').value.trim();
      const qty = n.querySelector('.item-qty').value;
      if(!name || !desc || !qty){ alert('Complete todos los campos de cada repuesto antes de enviar'); return; }
      payload.push({name,desc,qty});
    }
    // store as a request (simulate sending to provider)
    const key = 'mechanic_repuesto_requests';
    const existing = JSON.parse(localStorage.getItem(key)||'[]');
    existing.push({items:payload,createdAt:new Date().toISOString()});
    localStorage.setItem(key, JSON.stringify(existing));
    alert('Solicitud enviada');
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const badge = document.getElementById('sessionBadge');
  const logout = document.getElementById('logout');
  const user = JSON.parse(localStorage.getItem('user') || 'null');
  // Avoid exposing the raw role string (e.g. 'mecanico') in the topbar; show badge only for logged-in user
  if(badge){ if(user){ badge.textContent = user.name || 'Usuario'; badge.style.display='inline-block'; } else { badge.style.display='none'; } }
  if(logout) logout.addEventListener('click', ()=>{ localStorage.removeItem('demoRole'); localStorage.removeItem('user'); });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const userBtn = document.getElementById('userBtn');
  const userMenu = document.getElementById('userMenu');
  if(userBtn) userBtn.addEventListener('click', (e)=>{ e.preventDefault(); userMenu.classList.toggle('show'); });
});
</script>
</body>
</html>